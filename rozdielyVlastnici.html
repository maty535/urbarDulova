<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit podielov vlastn√≠kov</title>
    <style>
        @media (max-width: 600px) {

            .quick-note {
                font-size: 1.05rem; /* ƒåitateƒænej≈°ie na mobile */
            }
            /* 1. HLAVIƒåKA: D√°tum pod nadpisom, bez prekr√Ωvania */
            div[style*="position: relative"] {
                display: flex !important;
                flex-direction: column !important;
                align-items: flex-start !important;
                padding-bottom: 15px !important;
            }
            span[style*="position: absolute"] {
                position: static !important;
                transform: none !important;
                margin-top: 8px;
            }

            /* Kƒæ√∫ƒçov√° zmena pre oddelenie riadkov */
            .share-row {
                flex-direction: column !important;
                align-items: flex-start !important;
                padding: 12px 5px !important;
                background: transparent !important; /* ƒåist√© biele pozadie */
                border-bottom: 1px solid #b91c1c !important; /* Tenk√°, ale ostr√° ƒçerven√° ƒçiara */
            }

            .share-row:last-child {
                border-bottom: none !important; /* Posledn√Ω riadok v r√°mci jedn√©ho vlastn√≠ka u≈æ ƒçiaru nepotrebuje */
            }
            /* 3. D√ÅTA: Ka≈æd√© na svojom riadku */
            .fraction-col, .percent-col, .lv-info {
                width: 100% !important;
                padding: 4px 0 !important;
                text-align: center !important;
                border: none !important;
            }

            /* 2. SKRYTIE TEXTU "na listoch:" */
            /* V tvojom renderi je to v <span style="color: var(--text-muted)">na listoch:</span> */
            .lv-info span[style*="color: var(--text-muted)"],
            .dob-tag span[style*="color: var(--text-muted)"] {
                display: none !important;
            }

            .percent-col {
                color: var(--primary-color) !important;
                font-size: 1.2rem !important;
                font-weight: 800 !important;
            }

        .lv-numbers {
                font-size: 1.25rem !important;
                display: block;
                margin-top: 5px;
            }
            /* Z√°kladn√Ω ≈°t√Ωl pre ikonu */
            .lv-icon {
                color: var(--primary-color); /* Pou≈æije tvoju ƒçerven√∫ */
                font-weight: bold;
                margin-right: 8px;
            }
            /* ≈†√≠pka na mobile m√¥≈æe by≈• o nieƒço v√§ƒç≈°ia pre lep≈°iu navig√°ciu oka */
            .lv-icon {
                font-size: 1.2rem;
                display: inline-block;
                vertical-align: middle;
            }
            .lv-arrow {
                font-size: 1.5rem;
                display: inline-block !important; /* Na mobile sa ≈°√≠pka zobraz√≠ */
                color: #b91c1c; /* Ostr√° ƒçerven√° */
                margin-right: 5px;
                vertical-align: middle;
                font-weight: 900;
            }
        }
        /* 1. Z√ÅKLADN√â NASTAVENIE (Desktop) */
        .quick-note {
            background: #fffbeb;
            border-left: 3px solid #f59e0b;
            padding: 8px 12px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #92400e;
            border-radius: 4px;
        }
        
        .btn-edit-note {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 0.75rem;
            text-decoration: underline;
            cursor: pointer;
            margin-top: 5px;
        }
        .lv-arrow { display: none;}  /* ≈†√≠pka je predvolene skryt√° */
        :root { --primary-color: #b91c1c; --bg-body: #f8fafc; --text-muted: #64748b; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; padding: 40px; background: var(--bg-body); color: #334155; }
        .container { max-width: 1150px; margin: auto; }
        
        h1 { font-size: 2.2rem; color: var(--primary-color); margin-bottom: 5px; font-weight: 800; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; }
        .sub-header { font-size: 1.1rem; color: #475569; margin-bottom: 25px; font-weight: 600; }
        
        .search-box { width: 100%; padding: 12px 20px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 16px; margin-bottom: 25px; outline: none; box-sizing: border-box; box-shadow: inset 0 2px 4px rgba(0,0,0,0.02); }

        .card { background: white; border-radius: 12px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-left: 6px solid var(--primary-color); position: relative; }
        .owner-name { font-size: 1.5rem; font-weight: 800; color: #1e293b; }
        
        /* Spoloƒçn√Ω ≈°t√Ωl pre interakt√≠vne ≈°t√≠tky */
        .tag { display: inline-block; padding: 3px 10px; border-radius: 6px; font-weight: 700; font-size: 0.85rem; margin-left: 10px; border: 1px solid transparent; cursor: pointer; transition: all 0.2s; }
        
        .maiden-tag { background: #fef2f2; color: #b91c1c; border-color: #fee2e2; }
        .maiden-tag:hover { background: #fee2e2; transform: translateY(-1px); }
        
        .dob-tag { background: #f1f5f9; color: #475569; border-color: #e2e8f0; font-style: normal !important; }
        .dob-tag:hover { background: #e2e8f0; color: #1e293b; transform: translateY(-1px); }

        .mismatch-box { background: #fff5f5; border: 1px solid #fee2e2; border-radius: 10px; margin-top: 15px; overflow: hidden; }
        
        .share-row { display: flex; align-items: center; padding: 12px 20px; border-bottom: 1px solid #fee2e2; }
        .share-row:last-child { border-bottom: none; }

        .fraction-col { width: 100px; display: flex; justify-content: center; }
        .percent-col { width: 140px; font-family: 'Courier New', monospace; font-weight: 700; color: #b91c1c; font-size: 1.05rem; text-align: right; padding-right: 35px; }

        .lv-info { flex: 1; font-size: 1.05rem; border-left: 2px solid #fee2e2; padding-left: 25px; }
        .lv-numbers { font-weight: 700; color: var(--primary-color); }

        .fraction { display: inline-flex; flex-direction: column; vertical-align: middle; align-items: center; font-size: 0.95em; line-height: 1.1; font-weight: bold; }
        .fraction .num { border-bottom: 1.5px solid #1e293b; padding: 0 3px; }
        .fraction .den { padding: 0 3px; }
        .nema-val { font-weight: 800; color: #64748b; font-size: 1.1rem; }
    </style>
</head>
<body>

<div class="container">
    <div style="position: relative; border-bottom: 2px solid var(--primary-color); margin-bottom: 25px; padding-bottom: 10px; display: flex; align-items: center; justify-content: space-between;">
        <h1 style="margin: 0; border-bottom: none; padding: 0;">Nekonzistencie v podieloch vlastn√≠kov</h1>
        <span style="background: #1e293b; color: white; padding: 5px 15px; border-radius: 6px; font-size: 0.85rem; font-weight: 800; letter-spacing: 0.5px; white-space: nowrap;">
            STAV K 28. 02. 2026
        </span>
    </div>
    <div class="sub-header" id="stats">Naƒç√≠tavam d√°ta...</div>
    
    <input type="text" id="search" class="search-box" placeholder="Hƒæada≈• podƒæa mena, rodn√©ho mena alebo d√°tumu..." onkeyup="doSearch()">
    
    <div id="results"></div>
</div>

<script>
    let ownersData = [];

    function formatFraction(shareStr) {
        if (shareStr === "Nem√°") return '<div class="nema-val">Nem√°</div>';
        const match = shareStr.match(/{(\d+)}{(\d+)}/);
        if (match) return `<div class="fraction"><span class="num">${match[1]}</span><span class="den">${match[2]}</span></div>`;
        return shareStr;
    }

    // Univerz√°lna funkcia pre nastavenie filtra
    function setFilter(value) {
        const searchInput = document.getElementById('search');
        searchInput.value = value;
        doSearch();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

   async function render(data, notesMap = {}) {
        const out = document.getElementById('results');
        document.getElementById('stats').innerText = `N√°jden√Ωch ${data.length} vlastn√≠kov s rozdielnymi podielmi naprieƒç LV.`;
    
        out.innerHTML = data.map(item => {
            // --- SEM VKLAD√ÅME LOGIKU PRE KA≈ΩD√ö KARTU ---
            const ownerId = `${item.name}-${item.dob}`.replace(/\s+/g, '-').toLowerCase().replace(/[^a-z0-9-]/g, '');
            const note = notesMap[ownerId] || ""; 
            // ------------------------------------------
    
            return `
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span class="owner-name">${item.name}</span>
                            ${item.maiden ? `<span class="tag maiden-tag" onclick="setFilter('${item.maiden}')" title="Filtrova≈• rodn√© meno">r. ${item.maiden}</span>` : ''}
                        </div>
                        <div class="tag dob-tag" onclick="setFilter('${item.dob}')" title="Filtrova≈• d√°tum narodenia">
                            <span style="color: var(--text-muted)">Nar.:</span> ${item.dob}
                        </div>
                    </div>
                    <div class="mismatch-box">
                        ${item.details.map(d => {
                            const pMatch = d.share.match(/\(([\d\.]+)%\)/);
                            const percent = pMatch ? pMatch[1] : "";
                            return `
                                <div class="share-row">
                                    <div class="fraction-col">${formatFraction(d.share)}</div>
                                    <div class="percent-col">${percent ? percent + ' %' : ''}</div>
                                    <div class="lv-info">
                                        <span class="lv-arrow">‚Üì</span>
                                        <span class="lv-label" style="color: var(--text-muted)">na listoch:</span>
                                        <span class="lv-numbers">${d.lvs.join(', ')}</span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
    
                    ${note ? `<div class="quick-note">üìù ${note}</div>` : ''}
    
                    <div id="edit-ctrl-${ownerId}" style="margin-top: 10px; text-align: right;">
                        <button class="btn-edit-note" onclick="activateUtterances('${ownerId}')">
                            ${note ? 'Upravi≈• pozn√°mku' : '+ Prida≈• pozn√°mku'}
                        </button>
                    </div>
                </div>
            `;
        }).join('');
    }

    // 3. Funkcia, ktor√° aktivuje plnohodnotn√© Utterances pri kliknut√≠ na tlaƒçidlo
    function activateUtterances(ownerId) {
        const container = document.getElementById(`edit-ctrl-${ownerId}`);
        container.innerHTML = '<p style="font-size:0.8rem; color:var(--text-muted)">Naƒç√≠tavam editor...</p>';
        
        const script = document.createElement('script');
        script.src = "https://utteranc.es/client.js";
        script.setAttribute('repo', 'maty535/urbarDulova'); // <--- SEM DOPL≈á SVOJE
        script.setAttribute('issue-term', ownerId);
        script.setAttribute('label', 'pozn√°mka');
        script.setAttribute('theme', 'github-light');
        script.setAttribute('crossorigin', 'anonymous');
        script.async = true;
        
        container.appendChild(script);
    }

    async function fetchAllNotes() {
        const repo = "maty535/urbarDulova"; // DOPL≈á SVOJE
        try {
            // Stiahne posledn√Ωch 100 diskusi√≠ (pozn√°mok)
            const response = await fetch(`https://api.github.com/repos/${repo}/issues?state=all&labels=pozn√°mka`);
            const issues = await response.json();
            
            // Vytvor√≠ mapu: { 'meno-vlastnika': 'text pozn√°mky' }
            const notesMap = {};
            issues.forEach(issue => {
                notesMap[issue.title] = issue.body; // Utterances uklad√° ID do n√°zvu Issue
            });
            return notesMap;
        } catch (e) {
            console.error("Nepodarilo sa stiahnu≈• pozn√°mky:", e);
            return {};
        }
}
    
    function doSearch() {
        const term = document.getElementById('search').value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        const filtered = ownersData.filter(i => {
            const searchString = (i.name + (i.maiden || "") + i.dob).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            return searchString.includes(term);
        });
        render(filtered);
    }


    // T√°to funkcia spust√≠ cel√Ω proces
    async function initApp() {
        try {
            // 1. Naƒç√≠taj tvoje d√°ta z JSONu
            const response = await fetch('rozdiely.json');
            const data = await response.json();
            const allNotes = await fetchAllNotes(); // Bleskovo stiahne pozn√°mky
            // 2. Spusti render (ktor√Ω je teraz async)
            await render(data);
        } catch (err) {
            console.error("Chyba pri ≈°tarte:", err);
        }
    }
    
    // Spustenie aplik√°cie
    initApp();
    
</script>

</body>
</html>
