<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit podielov vlastníkov</title>
    <style>
        @media (max-width: 600px) {
            /* 1. HLAVIČKA: Dátum pod nadpisom, bez prekrývania */
            div[style*="position: relative"] {
                display: flex !important;
                flex-direction: column !important;
                align-items: flex-start !important;
                padding-bottom: 15px !important;
            }
            span[style*="position: absolute"] {
                position: static !important;
                transform: none !important;
                margin-top: 8px;
            }

            /* Kľúčová zmena pre oddelenie riadkov */
            .share-row {
                flex-direction: column !important;
                align-items: flex-start !important;
                padding: 12px 5px !important;
                background: transparent !important; /* Čisté biele pozadie */
                border-bottom: 1px solid #b91c1c !important; /* Tenká, ale ostrá červená čiara */
            }

            .share-row:last-child {
                border-bottom: none !important; /* Posledný riadok v rámci jedného vlastníka už čiaru nepotrebuje */
            }
            /* 3. DÁTA: Každé na svojom riadku */
            .fraction-col, .percent-col, .lv-info {
                width: 100% !important;
                padding: 4px 0 !important;
                text-align: center !important;
                border: none !important;
            }

            /* 2. SKRYTIE TEXTU "na listoch:" */
            /* V tvojom renderi je to v <span style="color: var(--text-muted)">na listoch:</span> */
            .lv-info span[style*="color: var(--text-muted)"],
            .dob-tag span[style*="color: var(--text-muted)"] {
                display: none !important;
            }

            .percent-col {
                color: var(--primary-color) !important;
                font-size: 1.2rem !important;
                font-weight: 800 !important;
            }

        .lv-numbers {
                font-size: 1.25rem !important;
                display: block;
                margin-top: 5px;
            }
            /* Základný štýl pre ikonu */
            .lv-icon {
                color: var(--primary-color); /* Použije tvoju červenú */
                font-weight: bold;
                margin-right: 8px;
            }
            /* Šípka na mobile môže byť o niečo väčšia pre lepšiu navigáciu oka */
            .lv-icon {
                font-size: 1.2rem;
                display: inline-block;
                vertical-align: middle;
            }
            .lv-arrow {
                font-size: 1.5rem;
                display: inline-block !important; /* Na mobile sa šípka zobrazí */
                color: #b91c1c; /* Ostrá červená */
                margin-right: 5px;
                vertical-align: middle;
                font-weight: 900;
            }
        }
        /* 1. ZÁKLADNÉ NASTAVENIE (Desktop) */
        .lv-arrow { display: none;}  /* Šípka je predvolene skrytá */
        :root { --primary-color: #b91c1c; --bg-body: #f8fafc; --text-muted: #64748b; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; padding: 40px; background: var(--bg-body); color: #334155; }
        .container { max-width: 1150px; margin: auto; }
        
        h1 { font-size: 2.2rem; color: var(--primary-color); margin-bottom: 5px; font-weight: 800; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; }
        .sub-header { font-size: 1.1rem; color: #475569; margin-bottom: 25px; font-weight: 600; }
        
        .search-box { width: 100%; padding: 12px 20px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 16px; margin-bottom: 25px; outline: none; box-sizing: border-box; box-shadow: inset 0 2px 4px rgba(0,0,0,0.02); }

        .card { background: white; border-radius: 12px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-left: 6px solid var(--primary-color); position: relative; }
        .owner-name { font-size: 1.5rem; font-weight: 800; color: #1e293b; }
        
        /* Spoločný štýl pre interaktívne štítky */
        .tag { display: inline-block; padding: 3px 10px; border-radius: 6px; font-weight: 700; font-size: 0.85rem; margin-left: 10px; border: 1px solid transparent; cursor: pointer; transition: all 0.2s; }
        
        .maiden-tag { background: #fef2f2; color: #b91c1c; border-color: #fee2e2; }
        .maiden-tag:hover { background: #fee2e2; transform: translateY(-1px); }
        
        .dob-tag { background: #f1f5f9; color: #475569; border-color: #e2e8f0; font-style: normal !important; }
        .dob-tag:hover { background: #e2e8f0; color: #1e293b; transform: translateY(-1px); }

        .mismatch-box { background: #fff5f5; border: 1px solid #fee2e2; border-radius: 10px; margin-top: 15px; overflow: hidden; }
        
        .share-row { display: flex; align-items: center; padding: 12px 20px; border-bottom: 1px solid #fee2e2; }
        .share-row:last-child { border-bottom: none; }

        .fraction-col { width: 100px; display: flex; justify-content: center; }
        .percent-col { width: 140px; font-family: 'Courier New', monospace; font-weight: 700; color: #b91c1c; font-size: 1.05rem; text-align: right; padding-right: 35px; }

        .lv-info { flex: 1; font-size: 1.05rem; border-left: 2px solid #fee2e2; padding-left: 25px; }
        .lv-numbers { font-weight: 700; color: var(--primary-color); }

        .fraction { display: inline-flex; flex-direction: column; vertical-align: middle; align-items: center; font-size: 0.95em; line-height: 1.1; font-weight: bold; }
        .fraction .num { border-bottom: 1.5px solid #1e293b; padding: 0 3px; }
        .fraction .den { padding: 0 3px; }
        .nema-val { font-weight: 800; color: #64748b; font-size: 1.1rem; }
    </style>
</head>
<body>

<div class="container">
    <div style="position: relative; border-bottom: 2px solid var(--primary-color); margin-bottom: 25px; padding-bottom: 10px; display: flex; align-items: center; justify-content: space-between;">
        <h1 style="margin: 0; border-bottom: none; padding: 0;">Nekonzistencie v podieloch vlastníkov</h1>
        <span style="background: #1e293b; color: white; padding: 5px 15px; border-radius: 6px; font-size: 0.85rem; font-weight: 800; letter-spacing: 0.5px; white-space: nowrap;">
            STAV K 28. 02. 2026
        </span>
    </div>
    <div class="sub-header" id="stats">Načítavam dáta...</div>
    
    <input type="text" id="search" class="search-box" placeholder="Hľadať podľa mena, rodného mena alebo dátumu..." onkeyup="doSearch()">
    
    <div id="results"></div>
</div>

<script>
    let ownersData = [];

    function formatFraction(shareStr) {
        if (shareStr === "Nemá") return '<div class="nema-val">Nemá</div>';
        const match = shareStr.match(/{(\d+)}{(\d+)}/);
        if (match) return `<div class="fraction"><span class="num">${match[1]}</span><span class="den">${match[2]}</span></div>`;
        return shareStr;
    }

    // Univerzálna funkcia pre nastavenie filtra
    function setFilter(value) {
        const searchInput = document.getElementById('search');
        searchInput.value = value;
        doSearch();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function render(data) {
        const out = document.getElementById('results');
        document.getElementById('stats').innerText = `Nájdených ${data.length} vlastníkov s rozdielnymi podielmi naprieč LV.`;
        
        out.innerHTML = data.map(item => `
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span class="owner-name">${item.name}</span>
                        ${item.maiden ? `<span class="tag maiden-tag" onclick="setFilter('${item.maiden}')" title="Filtrovať rodné meno">r. ${item.maiden}</span>` : ''}
                    </div>
                    <div class="tag dob-tag" onclick="setFilter('${item.dob}')" title="Filtrovať dátum narodenia">
                        <span style="color: var(--text-muted)">Nar.:</span> ${item.dob}
                    </div>
                </div>
                <div class="mismatch-box">
                    ${item.details.map(d => {
                        const pMatch = d.share.match(/\(([\d\.]+)%\)/);
                        const percent = pMatch ? pMatch[1] : "";
                        return `
                            <div class="share-row">
                                <div class="fraction-col">${formatFraction(d.share)}</div>
                                <div class="percent-col">${percent ? percent + ' %' : ''}</div>
                                <div class="lv-info">
                                    <span class="lv-arrow">↓</span>
                                    <span class="lv-label" style="color: var(--text-muted)">na listoch:</span>
                                    <span class="lv-numbers">${d.lvs.join(', ')}</span>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        `).join('');
    }

    function doSearch() {
        const term = document.getElementById('search').value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        const filtered = ownersData.filter(i => {
            const searchString = (i.name + (i.maiden || "") + i.dob).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            return searchString.includes(term);
        });
        render(filtered);
    }

    fetch('rozdiely.json').then(r => r.json()).then(data => {
        ownersData = data;
        render(data);
    });
</script>

</body>
</html>
